"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("middleware",{

/***/ "(middleware)/./middleware.ts":
/*!***********************!*\
  !*** ./middleware.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @clerk/nextjs/server */ \"(middleware)/./node_modules/@clerk/nextjs/dist/esm/server/routeMatcher.js\");\n/* harmony import */ var _clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @clerk/nextjs/server */ \"(middleware)/./node_modules/@clerk/nextjs/dist/esm/server/clerkMiddleware.js\");\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(middleware)/./node_modules/next/dist/esm/api/server.js\");\n\n\nconst isPublicRoute = (0,_clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_1__.createRouteMatcher)([\n    \"/sign-in(.*)\",\n    \"/sign-up(.*)\",\n    \"/api(.*)\"\n]);\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_2__.clerkMiddleware)(async (auth, req)=>{\n    const { userId } = await auth();\n    const { pathname } = req.nextUrl;\n    // Allow public routes\n    if (isPublicRoute(req)) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n    }\n    // If user is authenticated and on homepage, redirect based on role\n    if (userId && pathname === \"/\") {\n        try {\n            const userRes = await fetch(new URL(\"/api/users/me\", req.url).toString(), {\n                headers: {\n                    cookie: req.headers.get(\"cookie\") || \"\"\n                }\n            });\n            if (userRes.ok) {\n                const userData = await userRes.json();\n                const role = userData.role;\n                if (role === \"RIDER\") {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL(\"/rider\", req.url));\n                } else if (role === \"DRIVER\") {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL(\"/driver\", req.url));\n                } else if (role === \"DISPATCHER\") {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL(\"/dispatcher\", req.url));\n                } else if (role === \"ADMIN\") {\n                    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL(\"/admin\", req.url));\n                }\n            }\n        } catch (error) {\n            console.error(\"Error fetching user role:\", error);\n        }\n    }\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.next();\n}));\nconst config = {\n    matcher: [\n        \"/((?!.+\\\\.[\\\\w]+$|_next).*)\",\n        \"/\",\n        \"/(api|trpc)(.*)\"\n    ]\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKG1pZGRsZXdhcmUpLy4vbWlkZGxld2FyZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUEyRTtBQUNoQztBQUUzQyxNQUFNRyxnQkFBZ0JGLHdFQUFrQkEsQ0FBQztJQUN2QztJQUNBO0lBQ0E7Q0FDRDtBQUVELGlFQUFlRCxxRUFBZUEsQ0FBQyxPQUFPSSxNQUFNQztJQUMxQyxNQUFNLEVBQUVDLE1BQU0sRUFBRSxHQUFHLE1BQU1GO0lBQ3pCLE1BQU0sRUFBRUcsUUFBUSxFQUFFLEdBQUdGLElBQUlHLE9BQU87SUFFaEMsc0JBQXNCO0lBQ3RCLElBQUlMLGNBQWNFLE1BQU07UUFDdEIsT0FBT0gscURBQVlBLENBQUNPLElBQUk7SUFDMUI7SUFFQSxtRUFBbUU7SUFDbkUsSUFBSUgsVUFBVUMsYUFBYSxLQUFLO1FBQzlCLElBQUk7WUFDRixNQUFNRyxVQUFVLE1BQU1DLE1BQ3BCLElBQUlDLElBQUksaUJBQWlCUCxJQUFJUSxHQUFHLEVBQUVDLFFBQVEsSUFDMUM7Z0JBQ0VDLFNBQVM7b0JBQ1BDLFFBQVFYLElBQUlVLE9BQU8sQ0FBQ0UsR0FBRyxDQUFDLGFBQWE7Z0JBQ3ZDO1lBQ0Y7WUFHRixJQUFJUCxRQUFRUSxFQUFFLEVBQUU7Z0JBQ2QsTUFBTUMsV0FBVyxNQUFNVCxRQUFRVSxJQUFJO2dCQUNuQyxNQUFNQyxPQUFPRixTQUFTRSxJQUFJO2dCQUUxQixJQUFJQSxTQUFTLFNBQVM7b0JBQ3BCLE9BQU9uQixxREFBWUEsQ0FBQ29CLFFBQVEsQ0FBQyxJQUFJVixJQUFJLFVBQVVQLElBQUlRLEdBQUc7Z0JBQ3hELE9BQU8sSUFBSVEsU0FBUyxVQUFVO29CQUM1QixPQUFPbkIscURBQVlBLENBQUNvQixRQUFRLENBQUMsSUFBSVYsSUFBSSxXQUFXUCxJQUFJUSxHQUFHO2dCQUN6RCxPQUFPLElBQUlRLFNBQVMsY0FBYztvQkFDaEMsT0FBT25CLHFEQUFZQSxDQUFDb0IsUUFBUSxDQUFDLElBQUlWLElBQUksZUFBZVAsSUFBSVEsR0FBRztnQkFDN0QsT0FBTyxJQUFJUSxTQUFTLFNBQVM7b0JBQzNCLE9BQU9uQixxREFBWUEsQ0FBQ29CLFFBQVEsQ0FBQyxJQUFJVixJQUFJLFVBQVVQLElBQUlRLEdBQUc7Z0JBQ3hEO1lBQ0Y7UUFDRixFQUFFLE9BQU9VLE9BQU87WUFDZEMsUUFBUUQsS0FBSyxDQUFDLDZCQUE2QkE7UUFDN0M7SUFDRjtJQUVBLE9BQU9yQixxREFBWUEsQ0FBQ08sSUFBSTtBQUMxQixFQUFFLEVBQUM7QUFFSSxNQUFNZ0IsU0FBUztJQUNwQkMsU0FBUztRQUFDO1FBQStCO1FBQUs7S0FBa0I7QUFDbEUsRUFBRSIsInNvdXJjZXMiOlsiL1VzZXJzL2lzaGFxYmVsbG8vV2Vic2l0ZS9oYXZlbnJpZGVfZnVsbF9hcHAvbWlkZGxld2FyZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjbGVya01pZGRsZXdhcmUsIGNyZWF0ZVJvdXRlTWF0Y2hlciB9IGZyb20gXCJAY2xlcmsvbmV4dGpzL3NlcnZlclwiO1xuaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCI7XG5cbmNvbnN0IGlzUHVibGljUm91dGUgPSBjcmVhdGVSb3V0ZU1hdGNoZXIoW1xuICBcIi9zaWduLWluKC4qKVwiLFxuICBcIi9zaWduLXVwKC4qKVwiLFxuICBcIi9hcGkoLiopXCIsXG5dKTtcblxuZXhwb3J0IGRlZmF1bHQgY2xlcmtNaWRkbGV3YXJlKGFzeW5jIChhdXRoLCByZXEpID0+IHtcbiAgY29uc3QgeyB1c2VySWQgfSA9IGF3YWl0IGF1dGgoKTtcbiAgY29uc3QgeyBwYXRobmFtZSB9ID0gcmVxLm5leHRVcmw7XG5cbiAgLy8gQWxsb3cgcHVibGljIHJvdXRlc1xuICBpZiAoaXNQdWJsaWNSb3V0ZShyZXEpKSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5uZXh0KCk7XG4gIH1cblxuICAvLyBJZiB1c2VyIGlzIGF1dGhlbnRpY2F0ZWQgYW5kIG9uIGhvbWVwYWdlLCByZWRpcmVjdCBiYXNlZCBvbiByb2xlXG4gIGlmICh1c2VySWQgJiYgcGF0aG5hbWUgPT09IFwiL1wiKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXJSZXMgPSBhd2FpdCBmZXRjaChcbiAgICAgICAgbmV3IFVSTChcIi9hcGkvdXNlcnMvbWVcIiwgcmVxLnVybCkudG9TdHJpbmcoKSxcbiAgICAgICAge1xuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIGNvb2tpZTogcmVxLmhlYWRlcnMuZ2V0KFwiY29va2llXCIpIHx8IFwiXCIsXG4gICAgICAgICAgfSxcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgaWYgKHVzZXJSZXMub2spIHtcbiAgICAgICAgY29uc3QgdXNlckRhdGEgPSBhd2FpdCB1c2VyUmVzLmpzb24oKTtcbiAgICAgICAgY29uc3Qgcm9sZSA9IHVzZXJEYXRhLnJvbGU7XG5cbiAgICAgICAgaWYgKHJvbGUgPT09IFwiUklERVJcIikge1xuICAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTChcIi9yaWRlclwiLCByZXEudXJsKSk7XG4gICAgICAgIH0gZWxzZSBpZiAocm9sZSA9PT0gXCJEUklWRVJcIikge1xuICAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTChcIi9kcml2ZXJcIiwgcmVxLnVybCkpO1xuICAgICAgICB9IGVsc2UgaWYgKHJvbGUgPT09IFwiRElTUEFUQ0hFUlwiKSB7XG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdChuZXcgVVJMKFwiL2Rpc3BhdGNoZXJcIiwgcmVxLnVybCkpO1xuICAgICAgICB9IGVsc2UgaWYgKHJvbGUgPT09IFwiQURNSU5cIikge1xuICAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTChcIi9hZG1pblwiLCByZXEudXJsKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIHVzZXIgcm9sZTpcIiwgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBOZXh0UmVzcG9uc2UubmV4dCgpO1xufSk7XG5cbmV4cG9ydCBjb25zdCBjb25maWcgPSB7XG4gIG1hdGNoZXI6IFtcIi8oKD8hLitcXFxcLltcXFxcd10rJHxfbmV4dCkuKilcIiwgXCIvXCIsIFwiLyhhcGl8dHJwYykoLiopXCJdLFxufTtcbiJdLCJuYW1lcyI6WyJjbGVya01pZGRsZXdhcmUiLCJjcmVhdGVSb3V0ZU1hdGNoZXIiLCJOZXh0UmVzcG9uc2UiLCJpc1B1YmxpY1JvdXRlIiwiYXV0aCIsInJlcSIsInVzZXJJZCIsInBhdGhuYW1lIiwibmV4dFVybCIsIm5leHQiLCJ1c2VyUmVzIiwiZmV0Y2giLCJVUkwiLCJ1cmwiLCJ0b1N0cmluZyIsImhlYWRlcnMiLCJjb29raWUiLCJnZXQiLCJvayIsInVzZXJEYXRhIiwianNvbiIsInJvbGUiLCJyZWRpcmVjdCIsImVycm9yIiwiY29uc29sZSIsImNvbmZpZyIsIm1hdGNoZXIiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(middleware)/./middleware.ts\n");

/***/ })

});