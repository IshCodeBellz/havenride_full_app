(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2684],{704:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>c});var r=t(5155),a=t(2115),i=t(5419),l=t(4524),n=t(3371);function c(){let{user:e}=(0,i.Jd)(),[s,t]=(0,a.useState)([]),[c,d]=(0,a.useState)(!0),[o,x]=(0,a.useState)("all");(0,a.useEffect)(()=>{(null==e?void 0:e.id)&&s();async function s(){try{let s=await fetch("/api/bookings"),r=(await s.json()).filter(s=>s.riderId===(null==e?void 0:e.id)&&("COMPLETED"===s.status||"CANCELED"===s.status));t(r)}catch(e){console.error(e)}finally{d(!1)}}},[null==e?void 0:e.id]);let h=s.filter(e=>"all"===o||("completed"===o?"COMPLETED"===e.status:"canceled"!==o||"CANCELED"===e.status));return(0,r.jsx)(n.A,{requiredRole:["RIDER"],children:(0,r.jsx)(l.A,{userRole:"RIDER",children:(0,r.jsxs)("div",{className:"px-8 py-6 max-w-7xl mx-auto",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-[#0F3D3E] mb-2",children:"Past Rides"}),(0,r.jsx)("p",{className:"text-gray-600",children:"View your ride history"})]}),(0,r.jsx)("div",{className:"bg-white rounded-2xl p-6 shadow-sm mb-6",children:(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsxs)("button",{onClick:()=>x("all"),className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat("all"===o?"bg-[#00796B] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:["All (",s.length,")"]}),(0,r.jsxs)("button",{onClick:()=>x("completed"),className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat("completed"===o?"bg-[#00796B] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:["Completed (",s.filter(e=>"COMPLETED"===e.status).length,")"]}),(0,r.jsxs)("button",{onClick:()=>x("canceled"),className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat("canceled"===o?"bg-[#00796B] text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:["Canceled (",s.filter(e=>"CANCELED"===e.status).length,")"]})]})}),c?(0,r.jsx)("div",{className:"bg-white rounded-2xl p-12 shadow-sm text-center",children:(0,r.jsx)("p",{className:"text-gray-500",children:"Loading your past rides..."})}):0===h.length?(0,r.jsxs)("div",{className:"bg-white rounded-2xl p-12 shadow-sm text-center",children:[(0,r.jsx)("p",{className:"text-gray-500 text-lg mb-2",children:"No rides found"}),(0,r.jsx)("p",{className:"text-gray-400 text-sm",children:"all"===o?"You haven't completed any rides yet":"You have no ".concat(o," rides")})]}):(0,r.jsx)("div",{className:"space-y-4",children:h.map(e=>(0,r.jsxs)("div",{className:"bg-white rounded-2xl p-6 shadow-sm hover:shadow-md transition-shadow",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,r.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-semibold ".concat("COMPLETED"===e.status?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:e.status}),(0,r.jsx)("span",{className:"text-sm text-gray-500",children:new Date(e.createdAt).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})})]})}),e.finalFareAmount&&(0,r.jsx)("div",{className:"text-right",children:(0,r.jsxs)("div",{className:"text-2xl font-bold text-[#0F3D3E]",children:["\xa3",e.finalFareAmount.toFixed(2)]})})]}),(0,r.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"mt-1",children:(0,r.jsx)("div",{className:"w-3 h-3 rounded-full bg-blue-500"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Pickup"}),(0,r.jsx)("div",{className:"font-medium text-gray-900",children:e.pickupAddress})]})]}),(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"mt-1",children:(0,r.jsx)("div",{className:"w-3 h-3 rounded-full bg-green-500"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Drop-off"}),(0,r.jsx)("div",{className:"font-medium text-gray-900",children:e.dropoffAddress})]})]})]}),(0,r.jsxs)("div",{className:"border-t pt-4 grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.estimatedDistance&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Distance"}),(0,r.jsxs)("div",{className:"font-medium",children:[e.estimatedDistance.toFixed(1)," km"]})]}),e.estimatedDuration&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Duration"}),(0,r.jsxs)("div",{className:"font-medium",children:[e.estimatedDuration.toFixed(0)," min"]})]}),e.requiresWheelchair&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Accessibility"}),(0,r.jsx)("div",{className:"font-medium",children:"â™¿ Wheelchair"})]}),e.driverPhone&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Driver"}),(0,r.jsx)("div",{className:"font-medium text-sm",children:e.driverPhone})]})]}),"COMPLETED"===e.status&&e.rideQuality&&(0,r.jsxs)("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:[(0,r.jsx)("div",{className:"text-sm font-semibold text-green-800 mb-3",children:"Driver's Ride Report"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Quality:"}),(0,r.jsx)("span",{className:"ml-2 font-medium capitalize",children:e.rideQuality}),(0,r.jsxs)("span",{className:"ml-1",children:["excellent"===e.rideQuality&&"\uD83C\uDF1F","good"===e.rideQuality&&"\uD83D\uDC4D","fair"===e.rideQuality&&"\uD83D\uDC4C","poor"===e.rideQuality&&"\uD83D\uDE1E"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Comfort:"}),(0,r.jsx)("span",{className:"ml-2 font-medium capitalize",children:e.clientComfort.replace("_"," ")}),(0,r.jsxs)("span",{className:"ml-1",children:["very_comfortable"===e.clientComfort&&"\uD83D\uDE0A","comfortable"===e.clientComfort&&"\uD83D\uDE42"]})]})]}),(e.accessibilityNotes||e.issuesReported)&&(0,r.jsxs)("div",{className:"mt-3 pt-3 border-t border-green-300 space-y-2",children:[e.accessibilityNotes&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-gray-600 mb-1",children:"Accessibility Notes:"}),(0,r.jsx)("div",{className:"text-sm text-gray-700",children:e.accessibilityNotes})]}),e.issuesReported&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-gray-600 mb-1",children:"Issues Reported:"}),(0,r.jsx)("div",{className:"text-sm text-gray-700",children:e.issuesReported})]})]})]})]},e.id))})]})})})}},3371:(e,s,t)=>{"use strict";t.d(s,{A:()=>n});var r=t(5155),a=t(2115),i=t(63),l=t(5419);function n(e){let{children:s,requiredRole:t}=e,{user:n,isLoaded:c}=(0,l.Jd)(),d=(0,i.useRouter)(),[o,x]=(0,a.useState)(!0),[h,m]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{!async function(){if(c){if(!(null==n?void 0:n.id))return d.push("/");try{try{let e=await fetch("/api/users/ensure-role");if(!e.ok){let s=await e.text();console.error("Failed to ensure role:",s)}}catch(e){console.error("Error calling ensure-role:",e)}let e=await fetch("/api/users/me");if(!e.ok){console.error("Failed to fetch user data"),d.push("/");return}let s=(await e.json()).role;if(console.log("RoleGate: User role is",s,"Required:",t),!s){console.log("RoleGate: No role found, redirecting home"),d.push("/");return}if(t&&!t.includes(s)){console.log("RoleGate: User doesn't have required role, redirecting to their dashboard"),"RIDER"===s?d.push("/rider"):"DRIVER"===s?d.push("/driver"):"DISPATCHER"===s?d.push("/dispatcher"):"ADMIN"===s?d.push("/admin"):d.push("/");return}console.log("RoleGate: Access granted"),m(!0)}catch(e){console.error("Error checking role:",e)}finally{x(!1)}}}()},[n,c,d,t]),o)?(0,r.jsx)("div",{className:"max-w-4xl mx-auto p-6",children:(0,r.jsx)("div",{className:"text-center",children:"Loading..."})}):h?(0,r.jsx)(r.Fragment,{children:s}):null}},4524:(e,s,t)=>{"use strict";t.d(s,{A:()=>h});var r=t(5155),a=t(2619),i=t.n(a),l=t(5239),n=t(63),c=t(5419);function d(e){let{userRole:s}=e,t=(0,n.usePathname)(),a="DRIVER"===s?"/driver":"DISPATCHER"===s?"/dispatcher":"ADMIN"===s?"/admin":"/rider";return(0,r.jsxs)("div",{className:"w-64 min-h-screen bg-[#0F3D3E] text-white flex flex-col",children:[(0,r.jsx)("div",{className:"p-6 flex justify-center",children:(0,r.jsx)("div",{className:"w-32 h-32 bg-white rounded-full flex items-center justify-center",children:(0,r.jsx)(l.default,{src:"/images/HavenRideIcon.png",alt:"HavenRide Logo",width:120,height:120,className:"object-contain"})})}),(0,r.jsxs)("nav",{className:"flex-1 px-4 space-y-2",children:[(0,r.jsxs)(i(),{href:a,className:"flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ".concat(t===a?"bg-[#1a5557]":"hover:bg-[#1a5557] hover:bg-opacity-50"),children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),(0,r.jsx)("span",{children:"Home"})]}),(0,r.jsxs)(i(),{href:"".concat(a,"/past-rides"),className:"flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ".concat(t==="".concat(a,"/past-rides")?"bg-[#1a5557]":"hover:bg-[#1a5557] hover:bg-opacity-50"),children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,r.jsx)("span",{children:"Past Rides"})]}),(0,r.jsxs)(i(),{href:"".concat(a,"/support"),className:"flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ".concat(t==="".concat(a,"/support")?"bg-[#1a5557]":"hover:bg-[#1a5557] hover:bg-opacity-50"),children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,r.jsx)("span",{children:"Support"})]}),(0,r.jsxs)(i(),{href:"".concat(a,"/profile"),className:"flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ".concat(t==="".concat(a,"/profile")?"bg-[#1a5557]":"hover:bg-[#1a5557] hover:bg-opacity-50"),children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),(0,r.jsx)("span",{children:"Profile"})]}),"DRIVER"===s&&(0,r.jsxs)(i(),{href:"/driver/earnings",className:"flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ".concat("/driver/earnings"===t?"bg-[#1a5557]":"hover:bg-[#1a5557] hover:bg-opacity-50"),children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,r.jsx)("span",{children:"Earnings"})]})]}),(0,r.jsx)("div",{className:"p-4 border-t border-[#1a5557]",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(c.uF,{afterSignOutUrl:"/"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"text-sm font-medium",children:"Account"}),(0,r.jsx)("p",{className:"text-xs text-gray-300",children:s||"User"})]})]})})]})}var o=t(2115);function x(e){let{onTrigger:s}=e,[t,a]=(0,o.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>{a(!0),s&&s()},className:"fixed bottom-6 right-6 w-16 h-16 bg-red-600 rounded-full shadow-lg hover:bg-red-700 transition-all hover:scale-110 z-50 flex items-center justify-center",title:"Emergency SOS",children:(0,r.jsx)("span",{className:"text-white font-bold text-lg",children:"SOS"})}),t&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl p-8 max-w-md w-full",children:[(0,r.jsx)("div",{className:"flex justify-center mb-6",children:(0,r.jsx)("div",{className:"w-24 h-24 bg-red-600 rounded-full flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-white font-bold text-3xl",children:"SOS"})})}),(0,r.jsx)("h2",{className:"text-2xl font-bold text-center text-gray-900 mb-4",children:"Emergency in Progress"}),(0,r.jsx)("p",{className:"text-center text-gray-600 mb-6",children:"Your location and driver details will be shared with HavenRide Safety Desk"}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("button",{onClick:()=>{window.location.href="tel:999"},className:"w-full bg-red-600 text-white py-4 rounded-lg font-semibold hover:bg-red-700 transition-colors flex items-center justify-center gap-2",children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),"Call 999"]}),(0,r.jsx)("button",{onClick:()=>{alert("Contacting HavenRide Safety Desk...")},className:"w-full border-2 border-gray-300 text-gray-700 py-4 rounded-lg font-semibold hover:bg-gray-50 transition-colors",children:"Contact HavenRide Safety Desk"}),(0,r.jsx)("button",{onClick:()=>{a(!1)},className:"w-full border-2 border-gray-300 text-gray-700 py-4 rounded-lg font-semibold hover:bg-gray-50 transition-colors",children:"Cancel Alert"})]}),(0,r.jsx)("p",{className:"text-xs text-center text-gray-500 mt-6",children:"In case of immediate danger, contact local emergency services."})]})})]})}function h(e){let{children:s,userRole:t}=e;return(0,r.jsxs)("div",{className:"flex min-h-screen bg-gray-50",children:[(0,r.jsx)(d,{userRole:t}),(0,r.jsx)("main",{className:"flex-1 overflow-auto",children:s}),("RIDER"===t||"DRIVER"===t)&&(0,r.jsx)(x,{})]})}},7586:(e,s,t)=>{Promise.resolve().then(t.bind(t,704))}},e=>{e.O(0,[1162,5481,8441,1255,7358],()=>e(e.s=7586)),_N_E=e.O()}]);